---
title: "Data Science : Rush Hour"
date: 2019-02-13 17:32:00 +0900
categories: Data Science
---

0. Motivation
여러가지 잡기술을 이용하여 하나의 프로젝트를 진행하고 납기까지 완료해보기.


1. 문제 제기 - Problem
취직하면 성남이나 판교로 갈 확률이 매우 높음.
매일매일, 왕복 2시간을 출퇴근에 사용해야 함.
하루의 10% 를 꼬박꼬박 소비해야함.


2. 해결 방안 - Solution
탄력근무제를 고려하여,
7시 ~ 10시 사이로 출근 시간을 가정하고,
최소 출근 시간대를 찾아냄 (+@ 최대 출근 시간대도 고려)
-> Min rush hour

3. 목적지 & 도착지 설정 (경도 longitude, 위도 latitude)
서울시립대 (127.0551130, 37.5834520) <-> 판교 (127.1126840, 37.3947670)

4. 데이터 수집 (Data Mining)
1단계 : 노가다. 매일 매일 네이버 지도 앱을 이용하여 소요시간 측정.


|    Date    |    Duration    |
|-----------------------------|
| 1902140119 |      19분      |
| 1902140920 |      45분      |
| 1902141207 |      36분      |
| 1902141734 |      59분      |
| 1902141808 |      66분      |
| 1902142043 |      38분      |
| 1902142257 |      26분      |
| 1902151225 |      33분      |
| 1902151948 |      39분      |
| 1902161445 |      40분      |
| 1902161758 |      41분      |
| 1902170005 |      24분      |
| 1902171151 |      30분      |
| 1902171900 |      32분      |
| 1902172207 |      28분      |
| 1902172216 |      34분      |
| 1902180846 |      43분      |

----    출장으로 일시 중지    ----

| 1903091300 |      43분      |
| 1903100022 |      24분      |
| 1903132308 |      27분      |


*1단계 결과
Minimum Rush Hour = 2월 14일 새벽 1시 19분 : 19분
Maximum Rush Hour = 2월 14일 오후 6시 08분 : 66분

대략적으로 시간이 얼마나 걸리는지에 대한 느낌정도는 왔음.
그러나 4일정도 수동으로 일일히 데이터를 수집해본 결과, 가성비가 너무 안좋음.
매일 같은 시간에 데이터를 모을 수 없고, 느리고, 힘들고, 속상하고, 무엇보다 전문성이 매우 떨어짐. 굳이 컴퓨터를 쓸 필요가 있을까하는 의문.
-> 데이터 마이닝 자동화 시스템 필요


2단계 : Python 네이버 지도 크롤링
크롬의 개발자도구를 이용하여, Request url 을 얻어내고, 결과값을 얻어서 날짜와 소요시간을 저장.
(1) https://map.naver.com/ 에서 서울시립대학교 -> 판교역 길찾기,
(2) 개발자도구, command + option + i 이용하여 Network 들어가고, findCarRoute.nhn 함수 부분 확인
(3) Request url = 
https://map.naver.com/spirra/findCarRoute.nhn?route=route3&output=json&result=web3&coord_type=naver&search=2&car=0&mileage=12.4&start=127.0551130%2C37.5834520%2C%EC%84%9C%EC%9A%B8%EC%8B%9C%EB%A6%BD%EB%8C%80%ED%95%99%EA%B5%90&destination=127.1126840%2C37.3947670%2C%ED%8C%90%EA%B5%90%EC%97%AD+%EC%8B%A0%EB%B6%84%EB%8B%B9%EC%84%A0&via=
Response = {"routes":[{"summary":{"distance":정수, "duration":정수, 형태로 나오는 것 확인.

(4)Python으로 url 열어서 response 값 읽고, json으로 가져와서 dataset으로 받기.
```
#!/usr/env/bin python3

from urllib.request import urlopen
import json

url = 'https://m.map.naver.com/spirra/findCarRoute.nhn?route=route3&output=json&result=web3&coord_type=latlng&search=2&car=0&mileage=12.4&start=127.0551130%2C37.5834520%2C%EC%84%9C%EC%9A%B8%EC%8B%9C%EB%A6%BD%EB%8C%80%ED%95%99%EA%B5%90&destination=127.1126840%2C37.3947670%2C%ED%8C%90%EA%B5%90%EC%97%AD+%EC%8B%A0%EB%B6%84%EB%8B%B9%EC%84%A0'

content = urlopen(url).read()
jsonValue = json.loads(content)
dataset = jsonValue['routes'][0]['summary']
duration = dataset['duration']
durationSecToMin = duration / 60
durationSecToMin = round(durationSecToMin, 2)

#get date & time
import datetime
currentDT = datetime.datetime.now()

date = currentDT.strftime('%Y%m%d%H%M')
#date = (currentDT.year * 100000000) + (currentDT.month * 1000000) + (currentDT.day * 10000) + (currentDT.hour * 100) + currentDT.minute


#save to text file
textFile = open("dataset.txt", "a+")
textFile.write(str(date) + ' : ' + str(durationSecToMin) + '\n')
textFile.close()
```

이러면 수동 한번짜리 코드,

조금 더 자동화시켜서 켜두면 계속 크롤링하게 만들자.

```
#!/usr/env/bin python3

from urllib.request import urlopen
import json
import threading

def minRushHour() :
    url = 'https://m.map.naver.com/spirra/findCarRoute.nhn?route=route3&output=json&result=web3&coord_type=latlng&search=2&car=0&mileage=12.4&start=127.0551130%2C37.5834520%2C%EC%84%9C%EC%9A%B8%EC%8B%9C%EB%A6%BD%EB%8C%80%ED%95%99%EA%B5%90&destination=127.1126840%2C37.3947670%2C%ED%8C%90%EA%B5%90%EC%97%AD+%EC%8B%A0%EB%B6%84%EB%8B%B9%EC%84%A0'

    content = urlopen(url).read()
    jsonValue = json.loads(content)
    dataset = jsonValue['routes'][0]['summary']
    duration = dataset['duration']
    durationSecToMin = duration / 60
    durationSecToMin = round(durationSecToMin, 2)

    import datetime
    currentDT = datetime.datetime.now()

    date = currentDT.strftime('%Y%m%d%H%M')
    #date = (currentDT.year * 100000000) + (currentDT.month * 1000000) + (currentDT.day * 10000) + (currentDT.hour * 100) + currentDT.minute


    textFile = open("dataset.txt", "a+")
    textFile.write(str(date) + ' : ' + str(durationSecToMin) + '\n')
    textFile.close()


end = False

def autoFunction(second = 1.0):
    global end
    if end :
        return

    minRushHour()
    threading.Timer(second, autoFunction, [second]).start()


try :
    autoFunction(60)
except :
    print('warning')
```
